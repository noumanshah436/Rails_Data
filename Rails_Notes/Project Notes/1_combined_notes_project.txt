
==================================================================================================================================
Devise Setup
==================================================================================================================================
https://rubygems.org/
https://rubygems.org/gems/devise

devise gem:

Devise is the cornerstone gem for Ruby on Rails authentication. With Devise, creating a User that can log in and out of your application is so simple
because Devise takes care of all the controllers necessary for user creation ( users_controller ) and for user sessions ( users_sessions_controller ).

Go to https://rubygems.org/   and search for devise

1) copy gem to gemfile  ( gem 'devise', '~> 4.8', '>= 4.8.1'  )
Go to its doc at github https://github.com/heartcombo/devise


2) bundle install will install all the gems in the gemfile

3) rails generate devise:install

complete instructions

rails g devise:views

rails generate devise user    ( this is migration command )
rails db:migrate              ( migrate )

Add links to navbar and style each page with bootstrap




==================================================================================================================================
Add Bootstrap
==================================================================================================================================

https://www.youtube.com/watch?v=dqjF3C9A-Yg&t=794s   10:00

gem 'bootstrap', '~> 4.0.0'

bundle install

assets:
application.js
//= require bootstrap-sprockets


application.css renamed to aplication.scss

@import "bootstrap";









==================================================================================================================================
Update Devise User
==================================================================================================================================


https://github.com/heartcombo/devise#strong-parameters

1) create migration to add fields:
def change
    add_column :accounts, :website, :string
    add_column :accounts, :bio, :text
end


2) Allow new params attributes in application controller

before_action :configure_permitted_parameters, if: :devise_controller?

  protected

  def configure_permitted_parameters
    devise_parameter_sanitizer.permit(:sign_up, keys: [:name])
    devise_parameter_sanitizer.permit(:account_update, keys: [:name, :website, :bio])
  end

3) add fields in views








==================================================================================================================================
Credentials
==================================================================================================================================
Ruby on Rails #28 Action Mailer: Gmail SMTP - send emails in production for free
https://www.youtube.com/watch?v=eYhi_rbnOo8

1) EDITOR=vim rails credentials:edit

esc i   to insert

:wq    to save

2) add credentails in this file like:
google_smtp:
  email: --- ,
  password: ----

and access using
Rails.application.credentials.dig(:google_smtp, :email),










==================================================================================================================================
Email Verification devise
==================================================================================================================================


https://www.youtube.com/watch?v=GXsL2p0YoHg

https://github.com/heartcombo/devise/wiki/How-To:-Add-:confirmable-to-Users

***************************

1) add :confirmable in devise model
2) rails g migration add_confirmable_to_devise


class AddConfirmableToDevise < ActiveRecord::Migration[5.2]
   # Note: You can't use change, as User.update_all will fail in the down migration
  def up
    add_column :users, :confirmation_token, :string
    add_column :users, :confirmed_at, :datetime
    add_column :users, :confirmation_sent_at, :datetime
    add_column :users, :unconfirmed_email, :string # Only if using reconfirmable
    add_index :users, :confirmation_token, unique: true
    # User.reset_column_information # Need for some types of updates, but not for update_all.
    # To avoid a short time window between running the migration and updating all existing
    # users as confirmed, do the following
    User.update_all confirmed_at: DateTime.now
    # All existing user accounts should be able to log in after this.
  end

  def down
    remove_index :users, :confirmation_token
    remove_columns :users, :confirmation_token, :confirmed_at, :confirmation_sent_at
    # remove_columns :users, :unconfirmed_email # Only if using reconfirmable
  end
end




3) add in development.rb

config.action_mailer.perform_deliveries = true
  config.action_mailer.default_url_options = { host: 'localhost', port: 3000 }
  config.action_mailer.delivery_method = :smtp
  config.action_mailer.smtp_settings = {
    address: 'smtp.gmail.com',
    port: 587,
    domain: 'example.com',
    user_name: ENV["email"],
    password: ENV["password"],
    authentication: 'plain',
    enable_starttls_auto: true
  }



******************


if something went wrong

set it to true

  config.action_mailer.raise_delivery_errors = true


******************

Ruby on Rails #28 Action Mailer: Gmail SMTP - send emails in production for free
https://www.youtube.com/watch?v=eYhi_rbnOo8

1) EDITOR=vim rails credentials:edit

esc i   to insert

:wq    to save

2) add credentails in this file like:
google_smtp:
  email: --- ,
  password: ----

and access using
Rails.application.credentials.dig(:google_smtp, :email),



***********************








==================================================================================================================================
error pages
==================================================================================================================================


https://web-crunch.com/posts/custom-error-page-ruby-on-rails

rails g controller errors not_found internal_server_error








==================================================================================================================================
postgre sql
==================================================================================================================================


https://www.youtube.com/watch?v=v4yrpGy8NTs

sudo -u postgres psql


rails new instagram-clone -d postgresql
add credentials in config/database.yml
rails db:create







==================================================================================================================================
pundit
==================================================================================================================================


pundit
https://rubygems.org/gems/pundit/versions/1.1.0

https://github.com/varvet/pundit


1) add gem
gem 'pundit'
bundle

2)

rails g pundit:install

this will create policies folder in app

3)
rails g pundit:policy account  ( name of model in lowercase)

this will also initialze it in app policy

4) in application controller
include Pundit

****************

user is the current user in pundit
record is the object we passed with authorize


***************

def pundit_user
  current_account
end

def destroy
  authorize @post  # we can access this passed object using record
  if @post.destroy
    flash[:notice] = "Post deleted!"
  else
    flash[:alert] = "Something went wrong ..."
  end
  redirect_to posts_path
end


def destroy?
  user == record.account  #   return true if we want to allow this action
end

***************

rails g pundit:policy post
rails g pundit:policy comment
rails g pundit:policy account
rails g pundit:policy story








==================================================================================================================================
rspec   test
==================================================================================================================================



https://github.com/rspec/rspec-rails

https://relishapp.com/rspec/rspec-rails/docs/

https://relishapp.com/rspec/rspec-rails/v/5-1/docs/controller-specs/controller-spec

https://github.com/simplecov-ruby/simplecov

rspec playlist
https://www.youtube.com/watch?v=Spogv4o8haM&list=PLS6F722u-R6KiuOupokyl8Xnqrot9ukc7&index=47


***************************
run test:
1) rspec
2) RUBYOPT="-W0" rspec

***************************

1) gem 'rspec-rails'

2) rails generate rspec:install

3) rails generate model article            -- way to create model

rails generate rspec:model article         -- way to create rspec for this model


4) rails g rspec:controller articles


***********************

add in .rspec:

--format documentation

*********************

rails stats

*********************
https://github.com/pry/pry-rails

gem 'pry-rails'

bundle
*********************
simple cov

1) add gem and bundle
2) add 2 lines in spec_helper

xdg-open coverage/index.html

***********************

https://github.com/thoughtbot/factory_bot/blob/master/GETTING_STARTED.md#configure-your-test-suite

gem 'factory_bot_rails'
bundle


add in rails helper
config.include FactoryBot::Syntax::Methods

article = FactoryBot.create(:article)

***********************







==================================================================================================================================
rubocop
==================================================================================================================================


gem 'rubocop', require: false
bundle
rubocop --auto-gen-config
rubocop -a








==================================================================================================================================
active_model_serializers
==================================================================================================================================


docs:  https://github.com/rails-api/active_model_serializers/blob/0-10-stable/docs/general/getting_started.md




gem 'active_model_serializers', '~> 0.10.2'


rails g resource post title:string body:string



# frozen_string_literal: true

# PostSerializer
class PostSerializer < ActiveModel::Serializer
  belongs_to :user
  has_many :comments
  has_many :likes
  has_many :reports
  attributes :id, :title, :text, :created_at, :avatar_url, :comment_likes

  def avatar_url
    object.image.service_url if object.image.attached?
  end

  def comment_likes
    Like.group(:likeable_id).where(likeable_type: 'Comment').count
  end
end









==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================










==================================================================================================================================

==================================================================================================================================






